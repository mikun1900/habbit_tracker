import '../entities/task.dart';

/// タスクリポジトリインターフェース
///
/// タスクの永続化操作を定義する抽象クラスです。
/// インフラストラクチャ層でこのインターフェースを実装します。
abstract class TaskRepository {
  /// タスクを作成
  ///
  /// [task] 作成するタスクエンティティ
  ///
  /// 戻り値: 作成されたタスク
  /// 例外: データベースエラーなど
  Future<Task> createTask(Task task);

  /// IDでタスクを取得
  ///
  /// [id] タスクID
  ///
  /// 戻り値: 見つかったタスク、存在しない場合はnull
  Future<Task?> getTaskById(String id);

  /// すべてのタスクを取得
  ///
  /// 戻り値: 削除されていないすべてのタスクのリスト（作成日時昇順）
  Future<List<Task>> getAllTasks();

  /// すべてのタスクを監視するストリーム
  ///
  /// タスク一覧の変更をリアルタイムで監視します。
  /// 実装では定期的なポーリングやデータベースの変更通知を使用します。
  ///
  /// 戻り値: タスクリストの変更を通知するストリーム
  Stream<List<Task>> watchAllTasks();

  /// タスクを更新
  ///
  /// [task] 更新するタスクエンティティ
  ///
  /// 戻り値: 更新されたタスク
  /// 例外: タスクが存在しない場合やデータベースエラー
  Future<Task> updateTask(Task task);

  /// タスクを削除（論理削除）
  ///
  /// [id] 削除するタスクID
  ///
  /// 論理削除のため、isDeletedフラグをtrueに設定します。
  /// 関連する実行記録は外部キー制約により削除される可能性があります。
  ///
  /// 例外: タスクが存在しない場合やデータベースエラー
  Future<void> deleteTask(String id);

  /// タスクを完全削除（物理削除）
  ///
  /// [id] 削除するタスクID
  ///
  /// データベースから完全に削除します。
  /// 関連する実行記録も削除される可能性があります。
  ///
  /// 例外: タスクが存在しない場合やデータベースエラー
  Future<void> permanentlyDeleteTask(String id);
}
